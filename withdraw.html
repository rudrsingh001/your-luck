<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Withdraw</title>
  <style>
    body{font-family:Arial;margin:0;background:#0b66ff}
    .box{max-width:420px;margin:40px auto;background:#fff;border-radius:12px;padding:18px}
    input,button{width:100%;padding:12px;margin:8px 0;font-size:16px;box-sizing:border-box}
    button{background:#28a745;color:#fff;border:0;border-radius:8px}
    button:disabled{opacity:.6}
    .muted{color:#666;font-size:14px;line-height:1.4}
    a{color:#0b66ff;text-decoration:none}
    hr{border:0;border-top:1px solid #e5e5e5;margin:14px 0}
  </style>
</head>

<body>
  <div class="box">
    <h2>Withdraw Coins</h2>

    <p><b>Coins:</b> <span id="coins">0</span></p>
    <p><b>Balance:</b> ‚Çπ<span id="rupees">0</span></p>

    <p class="muted">Rule: 10 Coins = ‚Çπ1 | Minimum withdraw: 1000 coins (‚Çπ100)</p>
    <p class="muted">Note: 1 hour cooldown after every request.</p>

    <input id="name" placeholder="Your Name" />
    <input id="upi" placeholder="Your UPI ID (example: name@upi)" />
    <input id="wcoins" type="number" placeholder="Coins to Withdraw (min 1000)" />

    <button id="btn" onclick="submitWithdraw()">Request Withdrawal</button>

    <p id="msg" class="muted"></p>

    <hr>
    <a href="index.html">‚¨Ö Back to Home</a>
  </div>

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

  <script>
    /* ================== COINS UI ================== */
    let coins = localStorage.getItem("coins") ? parseInt(localStorage.getItem("coins")) : 0;
    document.getElementById("coins").innerText = coins;
    document.getElementById("rupees").innerText = (coins/10).toFixed(2);

    const msg = document.getElementById("msg");
    const btn = document.getElementById("btn");

    /* ================== (1) PASTE YOUR FIREBASE CONFIG HERE ================== */
    const firebaseConfig = {
      apiKey: "PASTE_HERE",
      authDomain: "PASTE_HERE",
      projectId: "PASTE_HERE",
      storageBucket: "PASTE_HERE",
      messagingSenderId: "PASTE_HERE",
      appId: "PASTE_HERE"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    /* ================== SETTINGS ================== */
    const MIN_WITHDRAW_COINS = 1000;
    const ONE_HOUR = 60 * 60 * 1000;

    /* ================== (2) TELEGRAM ADMIN NOTIFY SETTINGS ================== */
    // ‚úÖ Replace these 2 values
    const BOT_TOKEN = "TOKEN milega ";
    const CHAT_ID  = "7479186252";

    function notifyAdmin(name, upi, wcoins){
      // If token not set, skip silently
      if(!BOT_TOKEN || BOT_TOKEN.includes("PASTE_")) return;
      if(!CHAT_ID  || CHAT_ID.includes("PASTE_"))  return;

      const text =
`üö® NEW WITHDRAW REQUEST
üë§ Name: ${name}
üí≥ UPI: ${upi}
ü™ô Coins: ${wcoins}
üí∞ Amount: ‚Çπ${(wcoins/10).toFixed(2)}
‚è∞ Time: ${new Date().toLocaleString()}`;

      fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: CHAT_ID, text })
      });
    }

    function cooldownLeftMs(){
      const last = localStorage.getItem("lastWithdrawTime");
      if(!last) return 0;
      const diff = Date.now() - parseInt(last);
      return Math.max(0, ONE_HOUR - diff);
    }

    function submitWithdraw(){
      const name = document.getElementById("name").value.trim();
      const upi = document.getElementById("upi").value.trim();
      const wcoins = parseInt(document.getElementById("wcoins").value);

      // Basic checks
      if(!name || !upi || !wcoins){
        msg.innerText = "‚ùå Please fill all fields";
        return;
      }

      // Minimum coins rule
      if(wcoins < MIN_WITHDRAW_COINS){
        msg.innerText = "‚ùå Minimum 1000 coins required";
        return;
      }

      // Enough coins?
      if(wcoins > coins){
        msg.innerText = "‚ùå You don't have enough coins";
        return;
      }

      // 1 hour cooldown
      const left = cooldownLeftMs();
      if(left > 0){
        const mins = Math.ceil(left/60000);
        msg.innerText = "‚è≥ Please wait " + mins + " minutes before next withdrawal request.";
        return;
      }

      // Submit
      btn.disabled = true;
      btn.innerText = "Submitting...";
      msg.innerText = "‚è≥ Please wait...";

      db.collection("withdraw_requests").add({
        name: name,
        upi: upi,
        coins: wcoins,
        amount: wcoins / 10,
        status: "pending",
        createdAt: new Date().toISOString(),
        note: "Process within 1 hour"
      })
      .then(() => {
        // cooldown start
        localStorage.setItem("lastWithdrawTime", String(Date.now()));

        // admin notify
        notifyAdmin(name, upi, wcoins);

        msg.innerText =
          "‚úÖ Withdrawal request received!\n" +
          "‚è≥ Processing time: within 1 hour.\n" +
          "üí≥ Payment will be sent via UPI.";

        btn.disabled = false;
        btn.innerText = "Request Withdrawal";
        document.getElementById("wcoins").value = "";
      })
      .catch((err) => {
        msg.innerText = "‚ùå Error: " + err.message;
        btn.disabled = false;
        btn.innerText = "Request Withdrawal";
      });
    }
  </script>
</body>
</html>
